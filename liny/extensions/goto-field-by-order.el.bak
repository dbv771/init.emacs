(defun liny-sort-field (ov)
  "liny-sort-field is writen by ran9er"
  (let* (lst
         (o (liny-get-first ov))
         (go (lambda(ov)
               (if (null ov) nil
                 (setq lst (cons (cons (nth 1 (overlay-get ov 'id)) ov) lst))
                 (overlay-put ov 'first o)
                 (funcall go (overlay-get ov 'next))))))
    (funcall go o)
    (sort lst (lambda(x y)(<= (car x)(car y))))
    (if (eq 0 (caar lst))
        (setq lst (append (cdr lst)(list (car lst)))))
    (overlay-put o 'field-order lst)))

(defun liny-goto-field (p-or-n)
  (interactive)
  (let* ((o (liny-get-primary (liny-get-overlay)))
         (lst (or (overlay-get (or (overlay-get o 'first)
                                   liny-null-ov) 'field-order)(liny-sort-field o)))
         (oo (cdr (nth
                   (funcall
                    (cond ((eq p-or-n 'next) '1+)
                          ((eq p-or-n 'previous) '1-))
                    (- (length lst)
                       (length (member (rassq o lst)
                                       lst)))) lst))))
    (if oo
        (if (eq (overlay-get oo 'role) 'end)
            (if (y-or-n-p "finish this snippet?")
                (progn
                  (goto-char (overlay-end oo))
                  (liny-clear-instance o)))
          (overlay-put o 'offset (- (overlay-end o)(point)))
          (overlay-put o 'face 'liny-editable-face)
          (goto-char (- (overlay-end oo)(overlay-get oo 'offset)))
          (overlay-put oo 'face 'liny-active-face))
      (message "End of world."))))
