(setq l-snippets-syntax-delimiter
      (cons
       '("%" l-snippets-dynamic-overlay)
       l-snippets-syntax-delimiter))

(defun l-snippets-dynamic-overlay (str pos ovl)
  (let ((tail (l-snippets-get-tail ovl)))
    (if tail
        (progn
          (overlay-put tail 'insert-in-front-hooks
                       (cons 'l-snippets-ext-overlay
                             (overlay-get tail 'insert-in-front-hooks)))
          (overlay-put tail 'dynamic-tigger (read str)))
      (overlay-put ovl 'ext-templ str))))

(defun l-snippets-ext-overlay (ov after-p beg end &optional length)
  (if after-p
      (if (eq last-input-char (overlay-get ov 'dynamic-tigger))
          (let* ((ov (l-snippets-get-primary ov))
                 (id (read (make-temp-name "dy-")))
                 (o (progn
                      (l-snippets-move-overlay ov beg end t)
                      (l-snippets-clone-field ov end id))))

            "insert ov to instence lst after dynamic-overlay"
            ;; insert mirror
            ))))

(defun l-snippets-clone-primary (ov beg)
  (l-snippets-insert-field
   'primary
   (overlay-get ov 'id)
   (cdr
    (assoc
     (nth 1 id)
     (l-snippets-get-snippet
      (nth 0 id))))
   beg))
